<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pranath Fernando">
<meta name="dcterms.date" content="2022-03-18">
<meta name="description" content="In this article we will look at the history of the International Classification of Diseases (ICD) system, which has been developed collaboratively so that the medical terms and information in death certificates can be grouped together for statistical purposes. In practical examples we will look at how to extract ICD-9 codes from MIMIC III database and visualise them.">

<title>LivingDataLab - The International Classification of Disease System (ICD)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-91568149-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../css/styles.css">
<meta property="og:title" content="LivingDataLab - The International Classification of Disease System (ICD)">
<meta property="og:description" content="In this article we will look at the history of the International Classification of Diseases (ICD) system, which has been developed collaboratively so that the medical terms and information in death certificates can be grouped together for statistical purposes. In practical examples we will look at how to extract ICD-9 codes from MIMIC III database and visualise them.">
<meta property="og:image" content="https://github.com/pranath/blog/raw/master/images/ehr4.jpg">
<meta property="og:site-name" content="LivingDataLab">
<meta name="twitter:title" content="LivingDataLab - The International Classification of Disease System (ICD)">
<meta name="twitter:description" content="In this article we will look at the history of the International Classification of Diseases (ICD) system, which has been developed collaboratively so that the medical terms and information in death certificates can be grouped together for statistical purposes. In practical examples we will look at how to extract ICD-9 codes from MIMIC III database and visualise them.">
<meta name="twitter:image" content="https://github.com/pranath/blog/raw/master/images/ehr4.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">LivingDataLab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../projects.html" rel="" target="" aria-current="page">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://medium.com/@pranathfernando" rel="" target=""><i class="bi bi-medium" role="img">
</i> 
 <span class="menu-text">Medium</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/pranath-fernando/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/LivingDataLab" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.facebook.com/profile.php?id=61553930042412" rel="" target=""><i class="bi bi-facebook" role="img">
</i> 
 <span class="menu-text">Facebook</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pranath" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">The International Classification of Disease System (ICD)</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The International Classification of Disease System (ICD)</h1>
                  <div>
        <div class="description">
          In this article we will look at the history of the International Classification of Diseases (ICD) system, which has been developed collaboratively so that the medical terms and information in death certificates can be grouped together for statistical purposes. In practical examples we will look at how to extract ICD-9 codes from MIMIC III database and visualise them.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">health</div>
                <div class="quarto-category">electronic-health-records</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Pranath Fernando </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 18, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projects Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/doc-chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Document Chat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/doc-summarisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Document Summarisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/web-page-chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Web Page Chat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/web-page-summarisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Web Page Summarisation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/youtube-chat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YouTube Chat</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../projects/youtube-summarisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YouTube Summarisation</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-071822.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
    <form action="https://livingdatalab.us8.list-manage.com/subscribe/post?u=e2d57b0d6e43b4f6bff927a55&amp;id=a30bdff125&amp;f_id=009d05e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        <div id="mc_embed_signup_scroll">
        <h2>Subscribe</h2>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address
</label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" required="">
    <span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
    <div id="mce-responses" class="clear foot">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_e2d57b0d6e43b4f6bff927a55_a30bdff125" tabindex="-1" value=""></div>
        <div class="optionalParent">
            <div class="clear foot">
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
            </div>
        </div>
    </div>
</form>
</div>
<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->

</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#the-international-classification-of-disease-system-icd" id="toc-the-international-classification-of-disease-system-icd" class="nav-link" data-scroll-target="#the-international-classification-of-disease-system-icd"><span class="header-section-number">2</span> The International Classification of Disease System (ICD)</a></li>
  <li><a href="#the-evolution-of-the-icd-system" id="toc-the-evolution-of-the-icd-system" class="nav-link" data-scroll-target="#the-evolution-of-the-icd-system"><span class="header-section-number">3</span> The Evolution of the ICD System</a></li>
  <li><a href="#icd-9-and-mimic-iii" id="toc-icd-9-and-mimic-iii" class="nav-link" data-scroll-target="#icd-9-and-mimic-iii"><span class="header-section-number">4</span> ICD-9 and MIMIC-III</a></li>
  <li><a href="#extracting-icd-9-related-information-from-mimic-iii" id="toc-extracting-icd-9-related-information-from-mimic-iii" class="nav-link" data-scroll-target="#extracting-icd-9-related-information-from-mimic-iii"><span class="header-section-number">5</span> Extracting ICD-9 related information from MIMIC-III</a>
  <ul class="collapse">
  <li><a href="#number-of-patients-diagnosed-with-hypertension-above-30-years-old" id="toc-number-of-patients-diagnosed-with-hypertension-above-30-years-old" class="nav-link" data-scroll-target="#number-of-patients-diagnosed-with-hypertension-above-30-years-old"><span class="header-section-number">5.1</span> 1. Number of patients diagnosed with hypertension above 30 years old</a></li>
  <li><a href="#histogram-of-the-number-of-patients-diagnosed-with-hypertension" id="toc-histogram-of-the-number-of-patients-diagnosed-with-hypertension" class="nav-link" data-scroll-target="#histogram-of-the-number-of-patients-diagnosed-with-hypertension"><span class="header-section-number">5.2</span> 2. Histogram of the number of patients diagnosed with hypertension</a></li>
  <li><a href="#most-common-icd-9-codes-across-adults-patients" id="toc-most-common-icd-9-codes-across-adults-patients" class="nav-link" data-scroll-target="#most-common-icd-9-codes-across-adults-patients"><span class="header-section-number">5.3</span> 3. Most common ICD-9 codes across adults patients</a></li>
  <li><a href="#distribution-of-icd-9-codes-across-care-units" id="toc-distribution-of-icd-9-codes-across-care-units" class="nav-link" data-scroll-target="#distribution-of-icd-9-codes-across-care-units"><span class="header-section-number">5.4</span> 4. Distribution of ICD-9 codes across care units</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>In an <a href="2022-03-15-mimic-clinicial-outcomes-patient-data.html">earlier article we looked at how we can extract clinical outcomes and patient level data from the MIMIC-III EHR (Electronic Health Record) database</a>. In this article we will look at the history of the International Classification of Diseases (ICD) system, which has been developed collaboratively so that the medical terms and information in death certificates can be grouped together for statistical purposes. In practical examples we will look at how to extract ICD-9 codes from MIMIC III database and visualise them.</p>
</section>
<section id="the-international-classification-of-disease-system-icd" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-international-classification-of-disease-system-icd"><span class="header-section-number">2</span> The International Classification of Disease System (ICD)</h2>
<p>The World Health Organization is an agency that works on behalf of 194 member states. The aim of the organization is to promote the best standards in health for all people, regardless social and economic condition. As well as regardless of race, gender, religion and political beliefs. The main principle behind the organization work, is that access to affordable and articulate healthcare is a human right. For this reason, it promotes the fusion of universal health coverage.</p>
<p>There are several determinants that influence human health. This can be biomedical and genetic factors. Health behaviors, socioeconomic factors and environmental factors. The organization recognizes that we need to have common metrics to measure health and wellbeing. And some of those metrics are related to life expectancy, as well as mortality. Other metrics are subjective, and it depends of how well the person feelings. Disability, as well as illness and comorbidity are also measures of health and wellbeing.</p>
<p>The World Health Organisation aims to coordinate action among the member states, in order to intervene and improve health globally. To achieve this, it is required to collect data from patients, and this data will be analyzed from researchers, statisticians and clinicians to estimate indices of health and wellbeing. Technological and machine learning advances can promote healthcare and narrow the gap between rich and poor countries.</p>
<p>In order to collect data that can be compared across different locations and times. We need to have common notations and definitions. For this reason, the World Health Organization maintains a family of international classification schemes. In other words, there is a set of integrated classifications that provide a common language for health information across the world. <strong>The International Classification of Diseases</strong>, is the international standard diagnostic tool. For epidemiology, health management and clinical purposes.</p>
<p>The International Classification of Diseases, have been designed with the aim to describe various aspects of the health and the health systems in a consistent manner. In this way, it helps the development of reliable statistical systems at local, national and international levels. With the aim of improving status and health care. In practice, this process is used to translate diagnosis of diseases and other health problems from words into an alphanumeric code. The usage of the International Classification of Disease system. Provides a systematic way for storage, retrieval and analysis of the data.</p>
<p>The first type of users exposed in these classifications is in a clinic and it includes physician nurses and health workers. They integrate this information and they used it to support decision making for their patients. The second type of users are in administration and this can be health information managers, policymakers, insurers and national health program managers.</p>
<p>This data are also of paramount importance for population, health and epidemiology as well as research. They allow quantifying disability, diseases and risk factors in a global level. And they enable research in decision support system, based on artificial intelligence.</p>
<p>Summarizing, the International Classification of Diseases is one of the oldest and most important classification in medicine. It enables the optimal application of computer technology in the processing and retrieval of clinical information. Importantly, it is recognized internationally. Which enables sound statistical comparison of data, from different regions in different times.</p>
</section>
<section id="the-evolution-of-the-icd-system" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-evolution-of-the-icd-system"><span class="header-section-number">3</span> The Evolution of the ICD System</h2>
<p>The first effort to systematically classify diseases goes back in the 17th century. John Graunt, who was an epidemiologist and statistician, was looking into the death of children who’re born alive, but died before the age of six. He recognized the need to organize mortality data into some logical form and therefore develop the first statistical study of disease called the London Bills of Mortality.</p>
<p>William Farr is considered as the first medical statistician of the general Register Office of England and Wales. He submitted his report on Nomenclature and Statistical Classification of Diseases in 1855. In this report, he included most of those fatal diseases that affect health. In fact, in mid 80s, it was recognized the need of classification of diseases that was uniform and internationally accepted. Farr pointed out that medicine has progressed by that time and many diseases could affect particular organs, pointing out for a classification of diseases related to the organic systems they affect. He also considered previous classifications as largely symptomatic and the arrangements could not be used for statistical analysis.</p>
<p>The beginning of modern classification can be considered as the 1893. The chief of statistical services of Paris prepared a classification based on the principle of distinguishing between general diseases and those localized to a particular organ or anatomical site. Bertillon presented his report on causes of death and incapacity for work, including hospital admissions. Bertillon’s main headings included general diseases, diseases of nervous systems and sense organs, circulatory system, respiratory system, digestive system, and many others. The International Statistical Institute adapted the first edition of international classification system, the so-called the Internationally List of Causes of Death in 1893.</p>
<p>The ICD-10 coding system was endorsed by the 43rd World Health Assembly in May 1990. It came into use in World Health Organization member states as from 1994. ICD-10 involved a thorough rethinking of its structure and an effort to devise a stable and flexible classification which won’t require fundamental changes. Also, the structure of codes have changed from numeric to alphanumeric, which allows for significant expansion. The ICD-11 coding has been adopted by the 72nd World Health Assembly in 2019, and it comes into effect in January 2022. ICD-11 has been designed for digital use and it’s fully electronic. It aims to assist implementation and reduce error in diagnosis while it makes it more adaptable in local countries. The system has an improved ability to code for the quality and safety of health care and highlights socioeconomic factors that directly and indirectly contribute to people’s health. Finally, it also tries to simplify diagnostic descriptions, particularly in relation to mental health.</p>
<p>Summarizing, the need to organize disease data systematically was recognized in the 17th century. However, it wasn’t until the late 80s where the first international list of causes of death was founded. ICD codes are ubiquitously used in medicine and they are necessary to be able to compare statistics across different countries and across different times.</p>
</section>
<section id="icd-9-and-mimic-iii" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="icd-9-and-mimic-iii"><span class="header-section-number">4</span> ICD-9 and MIMIC-III</h2>
<p>ICD-9 is the disease classification system used in MIMIC-III. We will review its main structure, and we are going to see how the ICD codes can help us extract summary statistics from MIMIC-III database for example, to the number and distribution of patients across age which are diagnosed with a specific disease. We’re going to also see how we’re going to be able to put together queries to extract data with relation to the most common ICD codes in the MIMIC database and how these codes are distributed across ICU units.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/icd9-structure.png" class="img-fluid"></p>
<p>The main structure of the ICD-9 coding system consists of three digits that reflect a category and two digits that reflect the cause or the location. The World Health Organization requires a minimum of three-character categories level for international reporting and comparison. Therefore, these three digits always need to be provided with the corresponding number. Whereas the fourth digit is filled with X when there is no further information about the sub-division.</p>
<p><img src="https://github.com/pranath/blog/raw/master/images/icd9-chapters.png" class="img-fluid"></p>
<p>Here, we see a more detailed overview of the ICD-9 categories. In the first column, we see the codes related to the three first digits of the ICD-9 code. On the right column, we see the description of each of these categories. We start here with epidemic diseases and then we see diseases like neoplasm, endocrine, nutritional, and metabolic diseases and immunity disorders. We see here diseases of the blood and blood forming organs, mental disorders, and then we see also a number of diseases related with specific systems, such as the nervous system and sense organs, the circulatory system, the respiratory system, the digestive system, the genitourinary system, and so on.</p>
<p>Subsequently, we see developmental diseases, for example, congenital abnormalities. We also see injury and poisoning category. Finally, we see here that the last two categories, the first digit can be a letter. Both of this category offer a supplemental classification. We’re going to see how we can extract those codes from MIMIC-III. ICD codes in MIMIC-III are under the table of <em>Diagnoses_icd</em>.</p>
</section>
<section id="extracting-icd-9-related-information-from-mimic-iii" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="extracting-icd-9-related-information-from-mimic-iii"><span class="header-section-number">5</span> Extracting ICD-9 related information from MIMIC-III</h2>
<section id="number-of-patients-diagnosed-with-hypertension-above-30-years-old" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="number-of-patients-diagnosed-with-hypertension-above-30-years-old"><span class="header-section-number">5.1</span> 1. Number of patients diagnosed with hypertension above 30 years old</h3>
<p>We would like to count the number of patients who were diagnosed with hypertension and are at least 30 years old.</p>
<p>First, we need to combine the Admissions and Patients table to obtain the age (from date of birth and admission time), and filter out all patients younger than 30 years old. ICD9 diagnoses can be found in the Diagnoses_icd table (and descriptions of each code can be found in the D_icd_diagnoses table). We select all ICD-9 codes that are starting with 401, as these are related to hypertension.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose SQL query</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT p.subject_id, d.icd9_code, round((EXTRACT(EPOCH FROM (a.admittime-p.dob))/60/60/24/365.242) :: NUMERIC, 4) as age</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM public.patients p</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">  INNER JOIN public.Diagnoses_icd d ON p.subject_id = d.subject_id</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">  INNER JOIN public.Admissions a ON p.subject_id = a.subject_id</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE round((EXTRACT(EPOCH FROM (a.admittime-p.dob))/60/60/24/365.242) :: NUMERIC, 4) &gt; 30</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">  AND icd9_code LIKE '401%'</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Run query</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>query_output <span class="op">=</span> pd.read_sql_query(query,con)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>query_output.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">subject_id</th>
<th data-quarto-table-cell-role="th">icd9_code</th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10017</td>
<td>4019</td>
<td>73.6792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10019</td>
<td>4019</td>
<td>48.9014</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>10026</td>
<td>4010</td>
<td>300.0020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>10027</td>
<td>4019</td>
<td>82.4941</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10033</td>
<td>4019</td>
<td>81.6256</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="histogram-of-the-number-of-patients-diagnosed-with-hypertension" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="histogram-of-the-number-of-patients-diagnosed-with-hypertension"><span class="header-section-number">5.2</span> 2. Histogram of the number of patients diagnosed with hypertension</h3>
<p>Instead of counting the number of patients diagnosed with hypertension of 30 years and older, we would also like to see the distribution of hypertension diagnoses across different age groups for all ages. Hence, we do not want to filter out any age ranges.</p>
<p>The approach is very similar to the previous query. However, we now do not filter on age, and also select the age for each patient, to be able to create a histogram across different age ranges.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose SQL query</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT p.subject_id, d.icd9_code, round((EXTRACT(EPOCH FROM (a.admittime-p.dob))/60/60/24/365.242) :: NUMERIC, 4) as age</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM public.patients p</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">  INNER JOIN public.Diagnoses_icd d ON p.subject_id = d.subject_id</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">  INNER JOIN public.Admissions a ON p.subject_id = a.subject_id</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE icd9_code LIKE '401%'</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run query</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>query_output <span class="op">=</span> pd.read_sql_query(query,con)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>query_output.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">subject_id</th>
<th data-quarto-table-cell-role="th">icd9_code</th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10017</td>
<td>4019</td>
<td>73.6792</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10019</td>
<td>4019</td>
<td>48.9014</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>10026</td>
<td>4010</td>
<td>300.0020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>10027</td>
<td>4019</td>
<td>82.4941</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10033</td>
<td>4019</td>
<td>81.6256</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove outlier age </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> query_output[query_output[<span class="st">'age'</span>] <span class="op">&lt;</span> <span class="dv">300</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize distribution of age:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'age'</span>].hist(bins<span class="op">=</span><span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;AxesSubplot:&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2022-03-18-the-international-classification-of-disease_files/figure-html/cell-5-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="most-common-icd-9-codes-across-adults-patients" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="most-common-icd-9-codes-across-adults-patients"><span class="header-section-number">5.3</span> 3. Most common ICD-9 codes across adults patients</h3>
<p>We are interested in the ICD-9 codes sorted by their frequency, and want to select to five ICD-9 codes with the highest frequencies. We are only interested to see these results for adult (age &gt;= 16) patients who have been admitted to the ICU.</p>
<p>First, we combine the Patients and Admissions tables to obtain each patient’s age at time of hospital admission from their date of birth and hospital admission time. We also combine the Icustays tables, to filter out any patients who were not admitted to the ICU. We join the Diagnoses_icd and D_icd_diagnoses tables to get all ICD-9 codes and their descriptions. From the Diagnoses_icd table, we also take into account the priority of each ICD-9 code, as hospital admissions might correspond to multiple ICD-9 codes, but we are only interested in the primary diagnosis.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose SQL query</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT diag.hadm_id, diag.icd9_code, d_icd.short_title</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">FROM public.patients p</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.admissions a ON p.subject_id = a.subject_id</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.diagnoses_icd diag ON a.hadm_id = diag.hadm_id</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.d_icd_diagnoses d_icd ON diag.icd9_code = d_icd.icd9_code</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.icustays i ON a.hadm_id = i.hadm_id</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE round((EXTRACT(EPOCH FROM (a.admittime-p.dob))/60/60/24/365.242) :: NUMERIC, 4) &gt;= 16</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="st">AND diag.seq_num = 1</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Run query</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>query_output <span class="op">=</span> pd.read_sql_query(query,con)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>query_output.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hadm_id</th>
<th data-quarto-table-cell-role="th">icd9_code</th>
<th data-quarto-table-cell-role="th">short_title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>142345</td>
<td>99591</td>
<td>Sepsis</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>105331</td>
<td>570</td>
<td>Acute necrosis of liver</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>165520</td>
<td>0389</td>
<td>Septicemia NOS</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>199207</td>
<td>81201</td>
<td>Fx surg nck humerus-clos</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>177759</td>
<td>0389</td>
<td>Septicemia NOS</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Print key stats</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Top 5 ICD-9 codes and their frequencies'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query_output.drop_duplicates([<span class="st">'hadm_id'</span>])[<span class="st">'icd9_code'</span>].value_counts().head())</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">' '</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Top 5 ICD-9 codes and their frequencies by percentage'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query_output.drop_duplicates([<span class="st">'hadm_id'</span>])[<span class="st">'icd9_code'</span>].value_counts().head() <span class="op">/</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">len</span>(query_output.drop_duplicates([<span class="st">'hadm_id'</span>])[<span class="st">'icd9_code'</span>]) <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">' '</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Top 5 ICD-9 codes Disease Description'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>most_frequent_icd9s <span class="op">=</span> np.array(query_output.drop_duplicates([<span class="st">'hadm_id'</span>])[<span class="st">'icd9_code'</span>].value_counts().head().index.values)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>query_output.loc[query_output[<span class="st">'icd9_code'</span>].isin(most_frequent_icd9s)].drop_duplicates([<span class="st">'icd9_code'</span>]).drop(<span class="st">'hadm_id'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 5 ICD-9 codes and their frequencies
0389     15
486       6
51881     6
41071     5
4280      4
Name: icd9_code, dtype: int64
 
Top 5 ICD-9 codes and their frequencies by percentage
0389     11.627907
486       4.651163
51881     4.651163
41071     3.875969
4280      3.100775
Name: icd9_code, dtype: float64
 
Top 5 ICD-9 codes Disease Description</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">icd9_code</th>
<th data-quarto-table-cell-role="th">short_title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0389</td>
<td>Septicemia NOS</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>4280</td>
<td>CHF NOS</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>41071</td>
<td>Subendo infarct, initial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>51881</td>
<td>Acute respiratry failure</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>486</td>
<td>Pneumonia, organism NOS</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="distribution-of-icd-9-codes-across-care-units" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="distribution-of-icd-9-codes-across-care-units"><span class="header-section-number">5.4</span> 4. Distribution of ICD-9 codes across care units</h3>
<p>Instead of looking at the ICD-9 codes themselves, we will now take a look at the ICD-9 categories. ICD-9 codes can be grouped into nine larger categories (or ten if we have an ‘other’ category).</p>
<ul>
<li>(001-139): Infectious and parasitic diseases, i.e., septicemia, other infectious and parasitic diseases, etc.</li>
<li>(139-239): Neoplasms of digestive organs and intrathoracic organs, etc.</li>
<li>(240-279): Endocrine, nutritional, metabolic, and immunity.</li>
<li>(390-459): Diseases of the circulatory system, i.e., ischemic heart diseases, diseases of pulmonary circulation, dysrhythmias, heart failure, cerebrovascular diseases, etc.</li>
<li>(460-519): Pulmonary diseases, i.e., pneumonia and influenza, chronic obstructive pulmonary disease, etc.</li>
<li>(520-579): Diseases of the digestive system.</li>
<li>(580-629): Diseases of the genitourinary system, i.e., nephritis, nephrotic syndrome, nephrosis, and other diseases of the genitourinary system.</li>
<li>(800-959): Trauma.</li>
<li>(960-979): Poisoning by drugs and biological substances.</li>
</ul>
<p>ICD-codes can start with an m, v or e. These are supplementary classifications that we can classify under ‘Other’. We would like to have the distribution of these ICD-9 categories for all adult (age &gt;= 16) patients across different intensive care units (ICUs).</p>
<p>We need almost the same columns from all tables as for the previous query. However, we now also need the care unit that a patient was admitted to, from the Icustays table, and we need to extract the different ICD-9 categories from the ICD-9 codes.</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compose SQL query</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT a.hadm_id, i.first_careunit, diag.icd9_code,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">    CASE</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN (lower(LEFT(diag.icd9_code, 1)) = 'e') </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">            OR (lower(LEFT(diag.icd9_code, 1)) = 'v') </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">            OR (lower(LEFT(diag.icd9_code, 1)) = 'm') THEN 9</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 0 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 139 THEN 0</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 140 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 239 THEN 1</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 240 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 279 THEN 2</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 390 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 459 THEN 3</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 460 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 519 THEN 4</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 520 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 579 THEN 5</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 580 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 629 THEN 6</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 800 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 959 THEN 7</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">        WHEN CAST(LEFT(diag.icd9_code, 3) AS int) &gt;= 960 AND CAST(LEFT(diag.icd9_code, 3) AS int) &lt;= 989 THEN 8</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">        ELSE 9</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="st">    END AS icd9_category</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="st">FROM public.admissions a</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.icustays i ON a.hadm_id = i.hadm_id</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.patients p ON p.subject_id = a.subject_id</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.diagnoses_icd diag ON a.hadm_id = diag.hadm_id</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">INNER JOIN public.d_icd_diagnoses d_icd ON diag.icd9_code = d_icd.icd9_code</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE round((EXTRACT(EPOCH FROM (a.admittime-p.dob))/60/60/24/365.242) :: NUMERIC, 4) &gt;= 16</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">AND diag.seq_num = 1</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Run query</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>query_output <span class="op">=</span> pd.read_sql_query(query,con)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>query_output.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">hadm_id</th>
<th data-quarto-table-cell-role="th">first_careunit</th>
<th data-quarto-table-cell-role="th">icd9_code</th>
<th data-quarto-table-cell-role="th">icd9_category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>142345</td>
<td>MICU</td>
<td>99591</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>105331</td>
<td>MICU</td>
<td>570</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>165520</td>
<td>MICU</td>
<td>0389</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>199207</td>
<td>CCU</td>
<td>81201</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>177759</td>
<td>MICU</td>
<td>0389</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function for icd-9 categories per icu</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> icu_icd9_categories(df):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace category codes with names</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    categories_dict <span class="op">=</span> {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>: <span class="st">'Infectious and parasitic diseases'</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: <span class="st">'Neoplasms of digestive organs and intrathoracic organs, etc'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="dv">2</span>: <span class="st">'Endocrine, nutritional, metabolic, and immunity'</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>: <span class="st">'Diseases of the circulatory system'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">4</span>: <span class="st">'Pulmonary diseases'</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">5</span>: <span class="st">'Diseases of the digestive system'</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="dv">6</span>: <span class="st">'Diseases of the genitourinary system'</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>: <span class="st">'Trauma'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span>: <span class="st">'Poisoning by drugs and biological substances'</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="dv">9</span>: <span class="st">'Other'</span>}</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'icd9_category'</span>] <span class="op">=</span> df[<span class="st">'icd9_category'</span>].<span class="bu">map</span>(categories_dict)   </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get list of ICUs</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    icu_list <span class="op">=</span> df[<span class="st">'first_careunit'</span>].unique()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot pie chart for each ICU</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">40</span>,<span class="dv">50</span>))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    subplot <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> icu <span class="kw">in</span> icu_list:</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        icu_df <span class="op">=</span> df[df[<span class="st">'first_careunit'</span>] <span class="op">==</span> icu]</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        icu_df <span class="op">=</span> icu_df.drop_duplicates()</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        pie_df <span class="op">=</span> pd.DataFrame(icu_df[<span class="st">'icd9_category'</span>].value_counts() <span class="op">/</span> icu_df.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        pie_df <span class="op">=</span> pie_df.reset_index()</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        plt.subplot(<span class="dv">5</span>, <span class="dv">1</span>, subplot)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        plt.pie(pie_df[<span class="st">'icd9_category'</span>], labels<span class="op">=</span>pie_df[<span class="st">'index'</span>], autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Disease categories for '</span> <span class="op">+</span> icu)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        subplot <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Print key stats</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>icu_icd9_categories(query_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2022-03-18-the-international-classification-of-disease_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>


</section>
</section>

<link href="//cdn-images.mailchimp.com/embedcode/classic-071822.css" rel="stylesheet" type="text/css"><div id="mc_embed_signup">
    <form action="https://livingdatalab.us8.list-manage.com/subscribe/post?u=e2d57b0d6e43b4f6bff927a55&amp;id=a30bdff125&amp;f_id=009d05e0f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        <div id="mc_embed_signup_scroll">
        <h2 class="anchored">Subscribe</h2>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address
</label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" required="">
    <span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
    <div id="mce-responses" class="clear foot">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_e2d57b0d6e43b4f6bff927a55_a30bdff125" tabindex="-1" value=""></div>
        <div class="optionalParent">
            <div class="clear foot">
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
            </div>
        </div>
    </div>
</form>
</div><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("http:\/\/livingdatalab\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">LivingDataLab AI Technical Blog</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>